{% extends "lending/base.html" %}
{% load bootstrap5 %}
{% block title %}Request a Book{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Request a Book ðŸ“˜</h2>

  <div class="d-flex justify-content-center">
    <form method="post" class="w-50">
      {% csrf_token %}
      <div class="d-flex flex-column" style="width: 280px; margin: 0 auto;">
        {% bootstrap_field form.requested_book show_label=False %}
      </div>

      <div class="mb-3 text-center">
        {% if book.book_cover %}
        <img src="{{ book.book_cover.url }}" class="rounded mx-auto d-block img-fluid"
          style="min-width: 100px; height: 350px;">
        {% else %}
        <div class="rounded mx-auto d-block d-flex justify-content-center align-items-center"
          style="width: 250px; height: 350px; background-color: #ccc; color: #555; font-size: 1.2rem; font-weight: bold; text-align: center;">
          No Cover Available
        </div>
        {% endif %}

        {% if book %}
        <h1 class="fw-bold mt-2" style="font-size: clamp(2rem, 5vw, 3rem);"> {{ book.book_title }} </h1>
        <h4 style="font-weight: 400; font-size: clamp(1.5rem, 4vw, 1.5rem);"> {{ book.book_author }} </h4>
        <h4 style="font-size: clamp(1.5rem, 3vw, 1.5rem)">Status:
          {% if book.in_stock %}
          <span class="text-success" >Available ({{ book.total_available }}/{{ book.total_copies }})</span>
          {% else %}
          <span class="text-danger">No Copies Available ({{ book.total_available }}/{{ book.total_copies }})</span>
          {% endif %}
        </h4>
        {% else %}
        <h1 class="fw-bold mt-2" style="font-size: clamp(2rem, 5vw, 3rem);"> No Book Selected </h1>
        {% endif %}
      </div>

      <div class="d-flex justify-content-center">
        {% if book %}
        <button type="submit" class="btn btn-primary mt-2">Submit Request</button>
        {% else %}
        <button class="btn btn-primary disabled mt-2">Submit Request</button>
        {% endif %}
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const bookSelect = document.getElementById("id_requested_book");
    if (bookSelect) {
      bookSelect.addEventListener("change", function () {
        const selectedBookId = this.value;
        const url = new URL(window.location.href);
        url.searchParams.set("book", selectedBookId);
        window.location.href = url.toString();
      });
    }
  });
</script>
{% endblock %}